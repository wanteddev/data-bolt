digraph bigquery_agent {
  rankdir=LR;
  splines=true;
  node [shape=box, style="rounded,filled", fillcolor="#F8FAFC", color="#334155", fontname="Helvetica"];
  edge [color="#475569", fontname="Helvetica"];
  "__start__" [label="__start__", shape=ellipse, fillcolor="#DCFCE7"];
  "ingest" [label="ingest", shape=box, fillcolor="#EFF6FF"];
  "classify_relevance" [label="classify_relevance", shape=box, fillcolor="#EFF6FF"];
  "classify_intent" [label="classify_intent", shape=box, fillcolor="#EFF6FF"];
  "generate_or_validate" [label="generate_or_validate", shape=box, fillcolor="#EFF6FF"];
  "validate_candidate_sql" [label="validate_candidate_sql", shape=box, fillcolor="#EFF6FF"];
  "policy_gate" [label="policy_gate", shape=box, fillcolor="#EFF6FF"];
  "execute_sql" [label="execute_sql", shape=box, fillcolor="#EFF6FF"];
  "compose_response" [label="compose_response", shape=box, fillcolor="#EFF6FF"];
  "__end__" [label="__end__", shape=ellipse, fillcolor="#FEE2E2"];
  "__start__" -> "ingest";
  "classify_intent" -> "generate_or_validate";
  "classify_relevance" -> "__end__" [label="stop", style=dashed, color="#0EA5E9"];
  "classify_relevance" -> "classify_intent" [label="proceed", style=dashed, color="#0EA5E9"];
  "execute_sql" -> "compose_response";
  "generate_or_validate" -> "validate_candidate_sql";
  "ingest" -> "classify_relevance";
  "policy_gate" -> "compose_response" [label="skip", style=dashed, color="#0EA5E9"];
  "policy_gate" -> "execute_sql" [label="execute", style=dashed, color="#0EA5E9"];
  "validate_candidate_sql" -> "policy_gate";
  "compose_response" -> "__end__";
}
