digraph bigquery_agent_v2 {
  rankdir=LR;
  splines=true;
  node [shape=box, style="rounded,filled", fillcolor="#F8FAFC", color="#334155", fontname="Helvetica"];
  edge [color="#475569", fontname="Helvetica"];
  "__start__" [label="__start__", shape=ellipse, fillcolor="#DCFCE7"];
  "ingest" [label="ingest", shape=box, fillcolor="#EFF6FF"];
  "classify_relevance" [label="classify_relevance", shape=box, fillcolor="#EFF6FF"];
  "classify_intent_llm" [label="classify_intent_llm", shape=box, fillcolor="#EFF6FF"];
  "free_chat_planner" [label="free_chat_planner", shape=box, fillcolor="#EFF6FF"];
  "data_generate_or_validate" [label="data_generate_or_validate", shape=box, fillcolor="#EFF6FF"];
  "validate_candidate_sql" [label="validate_candidate_sql", shape=box, fillcolor="#EFF6FF"];
  "policy_gate" [label="policy_gate", shape=box, fillcolor="#EFF6FF"];
  "execute_sql" [label="execute_sql", shape=box, fillcolor="#EFF6FF"];
  "free_chat_respond" [label="free_chat_respond", shape=box, fillcolor="#EFF6FF"];
  "compose_response" [label="compose_response", shape=box, fillcolor="#EFF6FF"];
  "__end__" [label="__end__", shape=ellipse, fillcolor="#FEE2E2"];
  "__start__" -> "ingest";
  "classify_intent_llm" -> "data_generate_or_validate" [label="route_data", style=dashed, color="#0EA5E9"];
  "classify_intent_llm" -> "free_chat_planner" [label="route_chat", style=dashed, color="#0EA5E9"];
  "classify_relevance" -> "__end__" [label="stop", style=dashed, color="#0EA5E9"];
  "classify_relevance" -> "classify_intent_llm" [label="proceed", style=dashed, color="#0EA5E9"];
  "data_generate_or_validate" -> "validate_candidate_sql";
  "execute_sql" -> "compose_response" [label="data", style=dashed, color="#0EA5E9"];
  "execute_sql" -> "free_chat_respond" [label="chat", style=dashed, color="#0EA5E9"];
  "free_chat_planner" -> "data_generate_or_validate" [label="needs_data", style=dashed, color="#0EA5E9"];
  "free_chat_planner" -> "free_chat_respond" [label="chat_only", style=dashed, color="#0EA5E9"];
  "free_chat_respond" -> "compose_response" [label="chat", style=dashed, color="#0EA5E9"];
  "ingest" -> "classify_relevance";
  "policy_gate" -> "compose_response" [label="skip_data", style=dashed, color="#0EA5E9"];
  "policy_gate" -> "execute_sql" [label="execute", style=dashed, color="#0EA5E9"];
  "policy_gate" -> "free_chat_respond" [label="skip_chat", style=dashed, color="#0EA5E9"];
  "validate_candidate_sql" -> "policy_gate";
  "compose_response" -> "__end__";
}
