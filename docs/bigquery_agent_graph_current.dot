digraph BigQueryAgentCurrent {
  rankdir=LR;
  graph [fontname="Helvetica", fontsize=11, labelloc=t, label="BigQuery Agent Runtime (Current: loop only)"];
  node [shape=box, style="rounded,filled", fillcolor="#f8fafc", color="#334155", fontname="Helvetica", fontsize=10];
  edge [color="#475569", fontname="Helvetica", fontsize=9];

  START [shape=circle, style="filled", fillcolor="#dcfce7", color="#166534", label="START"];
  END [shape=doublecircle, style="filled", fillcolor="#fee2e2", color="#991b1b", label="END"];

  prepare_node [label="prepare_node\n(reset -> relevance -> ingest)", fillcolor="#dbeafe", color="#1d4ed8"];
  agent_node [label="agent_node\n(plan action/tool calls)", fillcolor="#fef3c7", color="#92400e"];
  tools_node [label="tools_node\n(tool registry + guarded_execute)", fillcolor="#fde68a", color="#92400e"];
  finalize_node [label="finalize_node\n(compose_response)"];

  START -> prepare_node;
  prepare_node -> agent_node;
  prepare_node -> finalize_node [label="irrelevant"];

  agent_node -> tools_node [label="tool_calls"];
  tools_node -> agent_node [label="continue loop"];

  agent_node -> finalize_node [label="no tool / finalized"];
  tools_node -> finalize_node [label="terminated"];

  finalize_node -> END;
}
