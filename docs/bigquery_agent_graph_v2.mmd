---
config:
  flowchart:
    curve: linear
---
graph TD;
	__start__([<p>__start__</p>]):::first
	ingest(ingest)
	classify_relevance(classify_relevance)
	classify_intent_llm(classify_intent_llm)
	free_chat_planner(free_chat_planner)
	data_generate_or_validate(data_generate_or_validate)
	validate_candidate_sql(validate_candidate_sql)
	policy_gate(policy_gate)
	execute_sql(execute_sql)
	free_chat_respond(free_chat_respond)
	compose_response(compose_response)
	__end__([<p>__end__</p>]):::last
	__start__ --> ingest;
	classify_intent_llm -. &nbsp;route_data&nbsp; .-> data_generate_or_validate;
	classify_intent_llm -. &nbsp;route_chat&nbsp; .-> free_chat_planner;
	classify_relevance -. &nbsp;stop&nbsp; .-> __end__;
	classify_relevance -. &nbsp;proceed&nbsp; .-> classify_intent_llm;
	data_generate_or_validate --> validate_candidate_sql;
	execute_sql -. &nbsp;data&nbsp; .-> compose_response;
	execute_sql -. &nbsp;chat&nbsp; .-> free_chat_respond;
	free_chat_planner -. &nbsp;needs_data&nbsp; .-> data_generate_or_validate;
	free_chat_planner -. &nbsp;chat_only&nbsp; .-> free_chat_respond;
	free_chat_respond -. &nbsp;chat&nbsp; .-> compose_response;
	ingest --> classify_relevance;
	policy_gate -. &nbsp;skip_data&nbsp; .-> compose_response;
	policy_gate -. &nbsp;execute&nbsp; .-> execute_sql;
	policy_gate -. &nbsp;skip_chat&nbsp; .-> free_chat_respond;
	validate_candidate_sql --> policy_gate;
	compose_response --> __end__;
	classDef default fill:#f2f0ff,line-height:1.2
	classDef first fill-opacity:0
	classDef last fill:#bfb6fc
